'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.replaceLn = replaceLn;
exports.printLn = printLn;
exports.formatBytes = formatBytes;
exports.formatNumber = formatNumber;
exports.padString = padString;
exports.waitIO = waitIO;
exports.delay = delay;
exports.trackProgress = trackProgress;
exports.newCid = newCid;
exports.shuffle = shuffle;
exports.waitAll = waitAll;
exports.partition = partition;
exports.sum = sum;


// noinspection JSUnusedGlobalSymbols
function replaceLn(text) {
  const CLEAR = '\r\x1B[2K\x1B[?7l';
  return print(CLEAR + text);
}

function printLn(text = '') {
  return print(text + '\n');
}

function print(text) {
  return new Promise((resolve, reject) => {
    process.stdout.write(text, err => {
      err ? reject(err) : resolve();
    });
  });
}

function formatBytes(n) {
  const { floor, pow, max, abs, log } = Math;
  let i = floor(log(max(abs(n), 1)) / log(1000));
  return i === 0 ? formatNumber(n, 0) + ' B' : formatNumber(n / pow(1000, i), 2) + ' ' + ' KMGTPEZY'[i] + 'B';
}

function roundDown(number, precision) {
  let factor = Math.pow(10, precision);
  return Math.floor(number * factor) / factor;
}

function formatNumber(n, decimals, integers = 1) {
  n = roundDown(n, decimals);
  return n.toLocaleString(undefined, {
    minimumFractionDigits: decimals,
    maximumFractionDigits: decimals,
    minimumIntegerDigits: integers
  });
}

function padString(str, len) {
  return str + ' '.repeat(Math.max(0, len - str.length));
}

// noinspection JSUnusedGlobalSymbols
function waitIO() {
  return new Promise(resolve => {
    setImmediate(resolve);
  });
}

// noinspection JSUnusedGlobalSymbols
function delay(delayMs) {
  return new Promise(resolve => {
    setTimeout(resolve, delayMs);
  });
}

async function trackProgress(func, loop, delayMs) {
  let running = false;
  let id = setInterval(async () => {
    if (!running) {
      running = true;
      await loop();
      running = false;
    }
  }, delayMs);
  await func();
  clearInterval(id);
  await loop();
}

let nextCid = 1;
function newCid() {
  return nextCid++;
}

/** Shuffle an array in place */
function shuffle(a) {
  let n = a.length;
  // Iterate through all but the last index
  for (let i = 0; i < n - 1; i++) {
    // Pick a random index from i to the end of the array
    let j = i + Math.floor(Math.random() * (n - i));
    // Swap this element with the random one
    let a_i = a[i];
    a[i] = a[j];
    a[j] = a_i;
  }
}

/** Promise.all but without building an array of return values */
async function waitAll(promises) {
  for (let promise of promises) {
    await promise;
  }
}

class AsyncCap {
  constructor(max) {
    this.count = 0;
    this.queue = [];

    this.max = max;
  }
  inc() {
    return new Promise((resolve, reject) => {
      this.queue.push({ resolve, reject });
      this.run();
    });
  }
  dec() {
    this.count--;
    this.run();
  }
  run() {
    while (this.queue.length > 0 && this.count < this.max) {
      this.count++;
      this.queue.shift().resolve();
    }
  }
}

exports.AsyncCap = AsyncCap; // noinspection JSUnusedGlobalSymbols

function partition(items, func) {
  let t = [];
  let f = [];
  for (let item of items) {
    (func(item) ? t : f).push(item);
  }
  return [t, f];
}

function sum(items, func) {
  let ret = 0;
  for (let item of items) {
    ret += func(item);
  }
  return ret;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy91dGlsLmpzIl0sIm5hbWVzIjpbInJlcGxhY2VMbiIsInByaW50TG4iLCJmb3JtYXRCeXRlcyIsImZvcm1hdE51bWJlciIsInBhZFN0cmluZyIsIndhaXRJTyIsImRlbGF5IiwidHJhY2tQcm9ncmVzcyIsIm5ld0NpZCIsInNodWZmbGUiLCJ3YWl0QWxsIiwicGFydGl0aW9uIiwic3VtIiwidGV4dCIsIkNMRUFSIiwicHJpbnQiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInByb2Nlc3MiLCJzdGRvdXQiLCJ3cml0ZSIsImVyciIsIm4iLCJmbG9vciIsInBvdyIsIm1heCIsImFicyIsImxvZyIsIk1hdGgiLCJpIiwicm91bmREb3duIiwibnVtYmVyIiwicHJlY2lzaW9uIiwiZmFjdG9yIiwiZGVjaW1hbHMiLCJpbnRlZ2VycyIsInRvTG9jYWxlU3RyaW5nIiwidW5kZWZpbmVkIiwibWluaW11bUZyYWN0aW9uRGlnaXRzIiwibWF4aW11bUZyYWN0aW9uRGlnaXRzIiwibWluaW11bUludGVnZXJEaWdpdHMiLCJzdHIiLCJsZW4iLCJyZXBlYXQiLCJsZW5ndGgiLCJzZXRJbW1lZGlhdGUiLCJkZWxheU1zIiwic2V0VGltZW91dCIsImZ1bmMiLCJsb29wIiwicnVubmluZyIsImlkIiwic2V0SW50ZXJ2YWwiLCJjbGVhckludGVydmFsIiwibmV4dENpZCIsImEiLCJqIiwicmFuZG9tIiwiYV9pIiwicHJvbWlzZXMiLCJwcm9taXNlIiwiQXN5bmNDYXAiLCJjb25zdHJ1Y3RvciIsImNvdW50IiwicXVldWUiLCJpbmMiLCJwdXNoIiwicnVuIiwiZGVjIiwic2hpZnQiLCJpdGVtcyIsInQiLCJmIiwiaXRlbSIsInJldCJdLCJtYXBwaW5ncyI6Ijs7Ozs7UUFHZ0JBLFMsR0FBQUEsUztRQUtBQyxPLEdBQUFBLE87UUFZQUMsVyxHQUFBQSxXO1FBYUFDLFksR0FBQUEsWTtRQWFBQyxTLEdBQUFBLFM7UUFLQUMsTSxHQUFBQSxNO1FBT0FDLEssR0FB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QUFDbEQsT0FBRCxFQUFVQyxNQUFWLEVBQWhCO0FBQ0EsV0FBS2tELEdBQUw7QUFDRCxLQUhNLENBQVA7QUFJRDtBQUNEQyxRQUFZO0FBQ1YsU0FBS0wsS0FBTDtBQUNBLFNBQUtJLEdBQUw7QUFDRDtBQUNEQSxRQUFZO0FBQ1YsV0FBTyxLQUFLSCxLQUFMLENBQVdwQixNQUFYLEdBQW9CLENBQXBCLElBQXlCLEtBQUttQixLQUFMLEdBQWEsS0FBS3RDLEdBQWxELEVBQXVEO0FBQ3JELFdBQUtzQyxLQUFMO0FBQ0EsV0FBS0MsS0FBTCxDQUFXSyxLQUFYLEdBQW1CckQsT0FBbkI7QUFDRDtBQUNGO0FBdEJtQjs7UUFBVDZDLFEsR0FBQUEsUSxFQXlCYjs7QUFDTyxTQUFTbkQsU0FBVCxDQUNMNEQsS0FESyxFQUVMdEIsSUFGSyxFQUdPO0FBQ1osTUFBSXVCLElBQUksRUFBUjtBQUNBLE1BQUlDLElBQUksRUFBUjtBQUNBLE9BQUssSUFBSUMsSUFBVCxJQUFpQkgsS0FBakIsRUFBd0I7QUFDdEIsS0FBQ3RCLEtBQUt5QixJQUFMLElBQWFGLENBQWIsR0FBaUJDLENBQWxCLEVBQXFCTixJQUFyQixDQUEwQk8sSUFBMUI7QUFDRDtBQUNELFNBQU8sQ0FBQ0YsQ0FBRCxFQUFJQyxDQUFKLENBQVA7QUFDRDs7QUFFTSxTQUFTN0QsR0FBVCxDQUFnQjJELEtBQWhCLEVBQW9DdEIsSUFBcEMsRUFBK0Q7QUFDcEUsTUFBSTBCLE1BQU0sQ0FBVjtBQUNBLE9BQUssSUFBSUQsSUFBVCxJQUFpQkgsS0FBakIsRUFBd0I7QUFDdEJJLFdBQU8xQixLQUFLeUIsSUFBTCxDQUFQO0FBQ0Q7QUFDRCxTQUFPQyxHQUFQO0FBQ0QiLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEBmbG93XG5cbi8vIG5vaW5zcGVjdGlvbiBKU1VudXNlZEdsb2JhbFN5bWJvbHNcbmV4cG9ydCBmdW5jdGlvbiByZXBsYWNlTG4odGV4dDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IENMRUFSID0gJ1xcclxceDFCWzJLXFx4MUJbPzdsJztcbiAgcmV0dXJuIHByaW50KENMRUFSICsgdGV4dCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwcmludExuKHRleHQ6IHN0cmluZyA9ICcnKTogUHJvbWlzZTx2b2lkPiB7XG4gIHJldHVybiBwcmludCh0ZXh0ICsgJ1xcbicpO1xufVxuXG5mdW5jdGlvbiBwcmludCh0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBwcm9jZXNzLnN0ZG91dC53cml0ZSh0ZXh0LCAoZXJyOiBtaXhlZCkgPT4ge1xuICAgICAgZXJyID8gcmVqZWN0KGVycikgOiByZXNvbHZlKCk7XG4gICAgfSk7XG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0Qnl0ZXMobjogbnVtYmVyKTogc3RyaW5nIHtcbiAgY29uc3Qge2Zsb29yLCBwb3csIG1heCwgYWJzLCBsb2d9ID0gTWF0aDtcbiAgbGV0IGkgPSBmbG9vcihsb2cobWF4KGFicyhuKSwgMSkpIC8gbG9nKDEwMDApKTtcbiAgcmV0dXJuIGkgPT09IDBcbiAgICA/IGZvcm1hdE51bWJlcihuLCAwKSArICcgQidcbiAgICA6IGZvcm1hdE51bWJlcihuIC8gcG93KDEwMDAsIGkpLCAyKSArICcgJyArICcgS01HVFBFWlknW2ldICsgJ0InO1xufVxuXG5mdW5jdGlvbiByb3VuZERvd24obnVtYmVyOiBudW1iZXIsIHByZWNpc2lvbjogbnVtYmVyKTogbnVtYmVyIHtcbiAgbGV0IGZhY3RvciA9IE1hdGgucG93KDEwLCBwcmVjaXNpb24pO1xuICByZXR1cm4gTWF0aC5mbG9vcihudW1iZXIgKiBmYWN0b3IpIC8gZmFjdG9yO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0TnVtYmVyKFxuICBuOiBudW1iZXIsXG4gIGRlY2ltYWxzOiBudW1iZXIsXG4gIGludGVnZXJzOiBudW1iZXIgPSAxLFxuKTogc3RyaW5nIHtcbiAgbiA9IHJvdW5kRG93bihuLCBkZWNpbWFscyk7XG4gIHJldHVybiBuLnRvTG9jYWxlU3RyaW5nKHVuZGVmaW5lZCwge1xuICAgIG1pbmltdW1GcmFjdGlvbkRpZ2l0czogZGVjaW1hbHMsXG4gICAgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiBkZWNpbWFscyxcbiAgICBtaW5pbXVtSW50ZWdlckRpZ2l0czogaW50ZWdlcnMsXG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFkU3RyaW5nKHN0cjogc3RyaW5nLCBsZW46IG51bWJlcik6IHN0cmluZyB7XG4gIHJldHVybiBzdHIgKyAnICcucmVwZWF0KE1hdGgubWF4KDAsIGxlbiAtIHN0ci5sZW5ndGgpKTtcbn1cblxuLy8gbm9pbnNwZWN0aW9uIEpTVW51c2VkR2xvYmFsU3ltYm9sc1xuZXhwb3J0IGZ1bmN0aW9uIHdhaXRJTygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgIHNldEltbWVkaWF0ZShyZXNvbHZlKTtcbiAgfSk7XG59XG5cbi8vIG5vaW5zcGVjdGlvbiBKU1VudXNlZEdsb2JhbFN5bWJvbHNcbmV4cG9ydCBmdW5jdGlvbiBkZWxheShkZWxheU1zOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgIHNldFRpbWVvdXQocmVzb2x2ZSwgZGVsYXlNcyk7XG4gIH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdHJhY2tQcm9ncmVzcyhcbiAgZnVuYzogKCkgPT4gUHJvbWlzZTx2b2lkPixcbiAgbG9vcDogKCkgPT4gUHJvbWlzZTx2b2lkPixcbiAgZGVsYXlNczogbnVtYmVyLFxuKTogUHJvbWlzZTx2b2lkPiB7XG4gIGxldCBydW5uaW5nID0gZmFsc2U7XG4gIGxldCBpZCA9IHNldEludGVydmFsKGFzeW5jICgpID0+IHtcbiAgICBpZiAoIXJ1bm5pbmcpIHtcbiAgICAgIHJ1bm5pbmcgPSB0cnVlO1xuICAgICAgYXdhaXQgbG9vcCgpO1xuICAgICAgcnVubmluZyA9IGZhbHNlO1xuICAgIH1cbiAgfSwgZGVsYXlNcyk7XG4gIGF3YWl0IGZ1bmMoKTtcbiAgY2xlYXJJbnRlcnZhbChpZCk7XG4gIGF3YWl0IGxvb3AoKTtcbn1cblxubGV0IG5leHRDaWQgPSAxO1xuZXhwb3J0IGZ1bmN0aW9uIG5ld0NpZCgpOiBudW1iZXIge1xuICByZXR1cm4gbmV4dENpZCsrO1xufVxuXG4vKiogU2h1ZmZsZSBhbiBhcnJheSBpbiBwbGFjZSAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNodWZmbGU8VD4oYTogVFtdKTogdm9pZCB7XG4gIGxldCBuID0gYS5sZW5ndGg7XG4gIC8vIEl0ZXJhdGUgdGhyb3VnaCBhbGwgYnV0IHRoZSBsYXN0IGluZGV4XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbiAtIDE7IGkrKykge1xuICAgIC8vIFBpY2sgYSByYW5kb20gaW5kZXggZnJvbSBpIHRvIHRoZSBlbmQgb2YgdGhlIGFycmF5XG4gICAgbGV0IGogPSBpICsgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG4gLSBpKSk7XG4gICAgLy8gU3dhcCB0aGlzIGVsZW1lbnQgd2l0aCB0aGUgcmFuZG9tIG9uZVxuICAgIGxldCBhX2kgPSBhW2ldO1xuICAgIGFbaV0gPSBhW2pdO1xuICAgIGFbal0gPSBhX2k7XG4gIH1cbn1cblxuLyoqIFByb21pc2UuYWxsIGJ1dCB3aXRob3V0IGJ1aWxkaW5nIGFuIGFycmF5IG9mIHJldHVybiB2YWx1ZXMgKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB3YWl0QWxsKFxuICBwcm9taXNlczogSXRlcmFibGU8UHJvbWlzZTx2b2lkPj4sXG4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgZm9yIChsZXQgcHJvbWlzZSBvZiBwcm9taXNlcykge1xuICAgIGF3YWl0IHByb21pc2U7XG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBQZW5kaW5nUHJvbWlzZTxUPiB7XG4gICtyZXNvbHZlOiBUID0+IHZvaWQ7XG4gICtyZWplY3Q6IG1peGVkID0+IHZvaWQ7XG59XG5cbmV4cG9ydCBjbGFzcyBBc3luY0NhcCB7XG4gIGNvdW50OiBudW1iZXIgPSAwO1xuICBxdWV1ZTogUGVuZGluZ1Byb21pc2U8dm9pZD5bXSA9IFtdO1xuICBtYXg6IG51bWJlcjtcbiAgY29uc3RydWN0b3IobWF4OiBudW1iZXIpIHtcbiAgICB0aGlzLm1heCA9IG1heDtcbiAgfVxuICBpbmMoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRoaXMucXVldWUucHVzaCh7cmVzb2x2ZSwgcmVqZWN0fSk7XG4gICAgICB0aGlzLnJ1bigpO1xuICAgIH0pO1xuICB9XG4gIGRlYygpOiB2b2lkIHtcbiAgICB0aGlzLmNvdW50LS07XG4gICAgdGhpcy5ydW4oKTtcbiAgfVxuICBydW4oKTogdm9pZCB7XG4gICAgd2hpbGUgKHRoaXMucXVldWUubGVuZ3RoID4gMCAmJiB0aGlzLmNvdW50IDwgdGhpcy5tYXgpIHtcbiAgICAgIHRoaXMuY291bnQrKztcbiAgICAgIHRoaXMucXVldWUuc2hpZnQoKS5yZXNvbHZlKCk7XG4gICAgfVxuICB9XG59XG5cbi8vIG5vaW5zcGVjdGlvbiBKU1VudXNlZEdsb2JhbFN5bWJvbHNcbmV4cG9ydCBmdW5jdGlvbiBwYXJ0aXRpb248VD4oXG4gIGl0ZW1zOiBJdGVyYWJsZTxUPixcbiAgZnVuYzogVCA9PiBib29sZWFuLFxuKTogW1RbXSwgVFtdXSB7XG4gIGxldCB0ID0gW107XG4gIGxldCBmID0gW107XG4gIGZvciAobGV0IGl0ZW0gb2YgaXRlbXMpIHtcbiAgICAoZnVuYyhpdGVtKSA/IHQgOiBmKS5wdXNoKGl0ZW0pO1xuICB9XG4gIHJldHVybiBbdCwgZl07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzdW08VD4oaXRlbXM6IEl0ZXJhYmxlPFQ+LCBmdW5jOiBUID0+IG51bWJlcik6IG51bWJlciB7XG4gIGxldCByZXQgPSAwO1xuICBmb3IgKGxldCBpdGVtIG9mIGl0ZW1zKSB7XG4gICAgcmV0ICs9IGZ1bmMoaXRlbSk7XG4gIH1cbiAgcmV0dXJuIHJldDtcbn1cbiJdfQ==
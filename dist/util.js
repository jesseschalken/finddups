'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.replaceLn = replaceLn;
exports.printLn = printLn;
exports.formatBytes = formatBytes;
exports.formatNumber = formatNumber;
exports.padString = padString;
exports.waitIO = waitIO;
exports.delay = delay;
exports.trackProgress = trackProgress;
exports.newCid = newCid;
exports.shuffle = shuffle;
exports.waitAll = waitAll;
exports.partition = partition;
exports.sum = sum;


// noinspection JSUnusedGlobalSymbols
function replaceLn(text) {
  const CLEAR = '\r\x1B[2K\x1B[?7l';
  return print(CLEAR + text);
}

function printLn(text = '') {
  return print(text + '\n');
}

function print(text) {
  return new Promise((resolve, reject) => {
    process.stdout.write(text, err => {
      err ? reject(err) : resolve();
    });
  });
}

function formatBytes(n) {
  const { floor, pow, max, abs, log } = Math;
  let i = floor(log(max(abs(n), 1)) / log(1000));
  return i === 0 ? formatNumber(n, 0) + ' B' : formatNumber(n / pow(1000, i), 2) + ' ' + ' KMGTPEZY'[i] + 'B';
}

function roundDown(number, precision) {
  let factor = Math.pow(10, precision);
  return Math.floor(number * factor) / factor;
}

function formatNumber(n, decimals, integers = 1) {
  n = roundDown(n, decimals);
  return n.toLocaleString(undefined, {
    minimumFractionDigits: decimals,
    maximumFractionDigits: decimals,
    minimumIntegerDigits: integers
  });
}

function padString(str, len) {
  return str + ' '.repeat(Math.max(0, len - str.length));
}

function waitIO() {
  return new Promise(resolve => {
    setImmediate(resolve);
  });
}

// noinspection JSUnusedGlobalSymbols
function delay(delayMs) {
  return new Promise(resolve => {
    setTimeout(resolve, delayMs);
  });
}

async function trackProgress(func, loop, delayMs) {
  let running = false;
  let id = setInterval(async () => {
    if (!running) {
      running = true;
      await loop();
      running = false;
    }
  }, delayMs);
  await func();
  clearInterval(id);
  await loop();
}

let nextCid = 1;
function newCid() {
  return nextCid++;
}

/** Shuffle an array in place */
function shuffle(a) {
  let n = a.length;
  // Iterate through all but the last index
  for (let i = 0; i < n - 1; i++) {
    // Pick a random index from i to the end of the array
    let j = i + Math.floor(Math.random() * (n - i));
    // Swap this element with the random one
    let a_i = a[i];
    a[i] = a[j];
    a[j] = a_i;
  }
}

/** Promise.all but without building an array of return values */
async function waitAll(promises) {
  for (let promise of promises) {
    await promise;
  }
}

class AsyncCap {
  constructor(max) {
    this.count = 0;
    this.queue = [];

    this.max = max;
  }
  inc() {
    return new Promise((resolve, reject) => {
      this.queue.push({ resolve, reject });
      this.run();
    });
  }
  dec() {
    this.count--;
    this.run();
  }
  run() {
    while (this.queue.length > 0 && this.count < this.max) {
      this.count++;
      this.queue.shift().resolve();
    }
  }
}

exports.AsyncCap = AsyncCap; // noinspection JSUnusedGlobalSymbols

function partition(items, func) {
  let t = [];
  let f = [];
  for (let item of items) {
    (func(item) ? t : f).push(item);
  }
  return [t, f];
}

function sum(items, func) {
  let ret = 0;
  for (let item of items) {
    ret += func(item);
  }
  return ret;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy91dGlsLmpzIl0sIm5hbWVzIjpbInJlcGxhY2VMbiIsInByaW50TG4iLCJmb3JtYXRCeXRlcyIsImZvcm1hdE51bWJlciIsInBhZFN0cmluZyIsIndhaXRJTyIsImRlbGF5IiwidHJhY2tQcm9ncmVzcyIsIm5ld0NpZCIsInNodWZmbGUiLCJ3YWl0QWxsIiwicGFydGl0aW9uIiwic3VtIiwidGV4dCIsIkNMRUFSIiwicHJpbnQiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInByb2Nlc3MiLCJzdGRvdXQiLCJ3cml0ZSIsImVyciIsIm4iLCJmbG9vciIsInBvdyIsIm1heCIsImFicyIsImxvZyIsIk1hdGgiLCJpIiwicm91bmREb3duIiwibnVtYmVyIiwicHJlY2lzaW9uIiwiZmFjdG9yIiwiZGVjaW1hbHMiLCJpbnRlZ2VycyIsInRvTG9jYWxlU3RyaW5nIiwidW5kZWZpbmVkIiwibWluaW11bUZyYWN0aW9uRGlnaXRzIiwibWF4aW11bUZyYWN0aW9uRGlnaXRzIiwibWluaW11bUludGVnZXJEaWdpdHMiLCJzdHIiLCJsZW4iLCJyZXBlYXQiLCJsZW5ndGgiLCJzZXRJbW1lZGlhdGUiLCJkZWxheU1zIiwic2V0VGltZW91dCIsImZ1bmMiLCJsb29wIiwicnVubmluZyIsImlkIiwic2V0SW50ZXJ2YWwiLCJjbGVhckludGVydmFsIiwibmV4dENpZCIsImEiLCJqIiwicmFuZG9tIiwiYV9pIiwicHJvbWlzZXMiLCJwcm9taXNlIiwiQXN5bmNDYXAiLCJjb25zdHJ1Y3RvciIsImNvdW50IiwicXVldWUiLCJpbmMiLCJwdXNoIiwicnVuIiwiZGVjIiwic2hpZnQiLCJpdGVtcyIsInQiLCJmIiwiaXRlbSIsInJldCJdLCJtYXBwaW5ncyI6Ijs7Ozs7UUFHZ0JBLFMsR0FBQUEsUztRQUtBQyxPLEdBQUFBLE87UUFZQUMsVyxHQUFBQSxXO1FBYUFDLFksR0FBQUEsWTtRQWFBQyxTLEdBQUFBLFM7UUFJQUMsTSxHQUFBQSxNO1FBT0FDLEssR0FB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RUFBVUMsTUFBVixFQUFoQjtBQUNBLFdBQUtrRCxHQUFMO0FBQ0QsS0FITSxDQUFQO0FBSUQ7QUFDREMsUUFBWTtBQUNWLFNBQUtMLEtBQUw7QUFDQSxTQUFLSSxHQUFMO0FBQ0Q7QUFDREEsUUFBWTtBQUNWLFdBQU8sS0FBS0gsS0FBTCxDQUFXcEIsTUFBWCxHQUFvQixDQUFwQixJQUF5QixLQUFLbUIsS0FBTCxHQUFhLEtBQUt0QyxHQUFsRCxFQUF1RDtBQUNyRCxXQUFLc0MsS0FBTDtBQUNBLFdBQUtDLEtBQUwsQ0FBV0ssS0FBWCxHQUFtQnJELE9BQW5CO0FBQ0Q7QUFDRjtBQXRCbUI7O1FBQVQ2QyxRLEdBQUFBLFEsRUF5QmI7O0FBQ08sU0FBU25ELFNBQVQsQ0FDTDRELEtBREssRUFFTHRCLElBRkssRUFHTztBQUNaLE1BQUl1QixJQUFJLEVBQVI7QUFDQSxNQUFJQyxJQUFJLEVBQVI7QUFDQSxPQUFLLElBQUlDLElBQVQsSUFBaUJILEtBQWpCLEVBQXdCO0FBQ3RCLEtBQUN0QixLQUFLeUIsSUFBTCxJQUFhRixDQUFiLEdBQWlCQyxDQUFsQixFQUFxQk4sSUFBckIsQ0FBMEJPLElBQTFCO0FBQ0Q7QUFDRCxTQUFPLENBQUNGLENBQUQsRUFBSUMsQ0FBSixDQUFQO0FBQ0Q7O0FBRU0sU0FBUzdELEdBQVQsQ0FBZ0IyRCxLQUFoQixFQUFvQ3RCLElBQXBDLEVBQStEO0FBQ3BFLE1BQUkwQixNQUFNLENBQVY7QUFDQSxPQUFLLElBQUlELElBQVQsSUFBaUJILEtBQWpCLEVBQXdCO0FBQ3RCSSxXQUFPMUIsS0FBS3lCLElBQUwsQ0FBUDtBQUNEO0FBQ0QsU0FBT0MsR0FBUDtBQUNEIiwiZmlsZSI6InV0aWwuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAZmxvd1xuXG4vLyBub2luc3BlY3Rpb24gSlNVbnVzZWRHbG9iYWxTeW1ib2xzXG5leHBvcnQgZnVuY3Rpb24gcmVwbGFjZUxuKHRleHQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCBDTEVBUiA9ICdcXHJcXHgxQlsyS1xceDFCWz83bCc7XG4gIHJldHVybiBwcmludChDTEVBUiArIHRleHQpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcHJpbnRMbih0ZXh0OiBzdHJpbmcgPSAnJyk6IFByb21pc2U8dm9pZD4ge1xuICByZXR1cm4gcHJpbnQodGV4dCArICdcXG4nKTtcbn1cblxuZnVuY3Rpb24gcHJpbnQodGV4dDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUodGV4dCwgZXJyID0+IHtcbiAgICAgIGVyciA/IHJlamVjdChlcnIpIDogcmVzb2x2ZSgpO1xuICAgIH0pO1xuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdEJ5dGVzKG46IG51bWJlcik6IHN0cmluZyB7XG4gIGNvbnN0IHtmbG9vciwgcG93LCBtYXgsIGFicywgbG9nfSA9IE1hdGg7XG4gIGxldCBpID0gZmxvb3IobG9nKG1heChhYnMobiksIDEpKSAvIGxvZygxMDAwKSk7XG4gIHJldHVybiBpID09PSAwXG4gICAgPyBmb3JtYXROdW1iZXIobiwgMCkgKyAnIEInXG4gICAgOiBmb3JtYXROdW1iZXIobiAvIHBvdygxMDAwLCBpKSwgMikgKyAnICcgKyAnIEtNR1RQRVpZJ1tpXSArICdCJztcbn1cblxuZnVuY3Rpb24gcm91bmREb3duKG51bWJlcjogbnVtYmVyLCBwcmVjaXNpb246IG51bWJlcik6IG51bWJlciB7XG4gIGxldCBmYWN0b3IgPSBNYXRoLnBvdygxMCwgcHJlY2lzaW9uKTtcbiAgcmV0dXJuIE1hdGguZmxvb3IobnVtYmVyICogZmFjdG9yKSAvIGZhY3Rvcjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdE51bWJlcihcbiAgbjogbnVtYmVyLFxuICBkZWNpbWFsczogbnVtYmVyLFxuICBpbnRlZ2VyczogbnVtYmVyID0gMSxcbik6IHN0cmluZyB7XG4gIG4gPSByb3VuZERvd24obiwgZGVjaW1hbHMpO1xuICByZXR1cm4gbi50b0xvY2FsZVN0cmluZyh1bmRlZmluZWQsIHtcbiAgICBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IGRlY2ltYWxzLFxuICAgIG1heGltdW1GcmFjdGlvbkRpZ2l0czogZGVjaW1hbHMsXG4gICAgbWluaW11bUludGVnZXJEaWdpdHM6IGludGVnZXJzLFxuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhZFN0cmluZyhzdHI6IHN0cmluZywgbGVuOiBudW1iZXIpOiBzdHJpbmcge1xuICByZXR1cm4gc3RyICsgJyAnLnJlcGVhdChNYXRoLm1heCgwLCBsZW4gLSBzdHIubGVuZ3RoKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB3YWl0SU8oKTogUHJvbWlzZTx2b2lkPiB7XG4gIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICBzZXRJbW1lZGlhdGUocmVzb2x2ZSk7XG4gIH0pO1xufVxuXG4vLyBub2luc3BlY3Rpb24gSlNVbnVzZWRHbG9iYWxTeW1ib2xzXG5leHBvcnQgZnVuY3Rpb24gZGVsYXkoZGVsYXlNczogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiB7XG4gIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICBzZXRUaW1lb3V0KHJlc29sdmUsIGRlbGF5TXMpO1xuICB9KTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHRyYWNrUHJvZ3Jlc3MoXG4gIGZ1bmM6ICgpID0+IFByb21pc2U8dm9pZD4sXG4gIGxvb3A6ICgpID0+IFByb21pc2U8dm9pZD4sXG4gIGRlbGF5TXM6IG51bWJlcixcbik6IFByb21pc2U8dm9pZD4ge1xuICBsZXQgcnVubmluZyA9IGZhbHNlO1xuICBsZXQgaWQgPSBzZXRJbnRlcnZhbChhc3luYyAoKSA9PiB7XG4gICAgaWYgKCFydW5uaW5nKSB7XG4gICAgICBydW5uaW5nID0gdHJ1ZTtcbiAgICAgIGF3YWl0IGxvb3AoKTtcbiAgICAgIHJ1bm5pbmcgPSBmYWxzZTtcbiAgICB9XG4gIH0sIGRlbGF5TXMpO1xuICBhd2FpdCBmdW5jKCk7XG4gIGNsZWFySW50ZXJ2YWwoaWQpO1xuICBhd2FpdCBsb29wKCk7XG59XG5cbmxldCBuZXh0Q2lkID0gMTtcbmV4cG9ydCBmdW5jdGlvbiBuZXdDaWQoKTogbnVtYmVyIHtcbiAgcmV0dXJuIG5leHRDaWQrKztcbn1cblxuLyoqIFNodWZmbGUgYW4gYXJyYXkgaW4gcGxhY2UgKi9cbmV4cG9ydCBmdW5jdGlvbiBzaHVmZmxlPFQ+KGE6IFRbXSk6IHZvaWQge1xuICBsZXQgbiA9IGEubGVuZ3RoO1xuICAvLyBJdGVyYXRlIHRocm91Z2ggYWxsIGJ1dCB0aGUgbGFzdCBpbmRleFxuICBmb3IgKGxldCBpID0gMDsgaSA8IG4gLSAxOyBpKyspIHtcbiAgICAvLyBQaWNrIGEgcmFuZG9tIGluZGV4IGZyb20gaSB0byB0aGUgZW5kIG9mIHRoZSBhcnJheVxuICAgIGxldCBqID0gaSArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChuIC0gaSkpO1xuICAgIC8vIFN3YXAgdGhpcyBlbGVtZW50IHdpdGggdGhlIHJhbmRvbSBvbmVcbiAgICBsZXQgYV9pID0gYVtpXTtcbiAgICBhW2ldID0gYVtqXTtcbiAgICBhW2pdID0gYV9pO1xuICB9XG59XG5cbi8qKiBQcm9taXNlLmFsbCBidXQgd2l0aG91dCBidWlsZGluZyBhbiBhcnJheSBvZiByZXR1cm4gdmFsdWVzICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gd2FpdEFsbChcbiAgcHJvbWlzZXM6IEl0ZXJhYmxlPFByb21pc2U8dm9pZD4+LFxuKTogUHJvbWlzZTx2b2lkPiB7XG4gIGZvciAobGV0IHByb21pc2Ugb2YgcHJvbWlzZXMpIHtcbiAgICBhd2FpdCBwcm9taXNlO1xuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUGVuZGluZ1Byb21pc2U8VD4ge1xuICArcmVzb2x2ZTogVCA9PiB2b2lkO1xuICArcmVqZWN0OiBtaXhlZCA9PiB2b2lkO1xufVxuXG5leHBvcnQgY2xhc3MgQXN5bmNDYXAge1xuICBjb3VudDogbnVtYmVyID0gMDtcbiAgcXVldWU6IFBlbmRpbmdQcm9taXNlPHZvaWQ+W10gPSBbXTtcbiAgbWF4OiBudW1iZXI7XG4gIGNvbnN0cnVjdG9yKG1heDogbnVtYmVyKSB7XG4gICAgdGhpcy5tYXggPSBtYXg7XG4gIH1cbiAgaW5jKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICB0aGlzLnF1ZXVlLnB1c2goe3Jlc29sdmUsIHJlamVjdH0pO1xuICAgICAgdGhpcy5ydW4oKTtcbiAgICB9KTtcbiAgfVxuICBkZWMoKTogdm9pZCB7XG4gICAgdGhpcy5jb3VudC0tO1xuICAgIHRoaXMucnVuKCk7XG4gIH1cbiAgcnVuKCk6IHZvaWQge1xuICAgIHdoaWxlICh0aGlzLnF1ZXVlLmxlbmd0aCA+IDAgJiYgdGhpcy5jb3VudCA8IHRoaXMubWF4KSB7XG4gICAgICB0aGlzLmNvdW50Kys7XG4gICAgICB0aGlzLnF1ZXVlLnNoaWZ0KCkucmVzb2x2ZSgpO1xuICAgIH1cbiAgfVxufVxuXG4vLyBub2luc3BlY3Rpb24gSlNVbnVzZWRHbG9iYWxTeW1ib2xzXG5leHBvcnQgZnVuY3Rpb24gcGFydGl0aW9uPFQ+KFxuICBpdGVtczogSXRlcmFibGU8VD4sXG4gIGZ1bmM6IFQgPT4gYm9vbGVhbixcbik6IFtUW10sIFRbXV0ge1xuICBsZXQgdCA9IFtdO1xuICBsZXQgZiA9IFtdO1xuICBmb3IgKGxldCBpdGVtIG9mIGl0ZW1zKSB7XG4gICAgKGZ1bmMoaXRlbSkgPyB0IDogZikucHVzaChpdGVtKTtcbiAgfVxuICByZXR1cm4gW3QsIGZdO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc3VtPFQ+KGl0ZW1zOiBJdGVyYWJsZTxUPiwgZnVuYzogVCA9PiBudW1iZXIpOiBudW1iZXIge1xuICBsZXQgcmV0ID0gMDtcbiAgZm9yIChsZXQgaXRlbSBvZiBpdGVtcykge1xuICAgIHJldCArPSBmdW5jKGl0ZW0pO1xuICB9XG4gIHJldHVybiByZXQ7XG59XG4iXX0=